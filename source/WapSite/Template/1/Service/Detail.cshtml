@page
@inject ICMSService _cmsService
@inject DataLibrary.DataContext Db
@functions{
    public DataLibrary.SiteBasic SiteBasic { get; set; }

    // 产品模型
    public DataLibrary.PdProduct PdProduct { get; set; }

    public DataLibrary.BaseProductClass ProductClass { get; set; }

    // 材质
    public DataLibrary.BaseProductMaterial Material { get; set; }

    // 规格
    public DataLibrary.BaseSpecifications Spec { get; set; }

    // 班组
    public DataLibrary.PdWorkshopTeam PdWorkshopTeam { get; set; }

    public DataLibrary.PdWorkshop PdWorkshop { get; set; }

    /// <summary>
    /// Gets or sets 出库纪录
    /// </summary>
    public DataLibrary.PdStockOut PdStockOut { get; set; }

    public void OnGet(string batcode, string validcode)
    {
        var bc = batcode;
        var vc = validcode;
        if (string.IsNullOrEmpty(bc) && string.IsNullOrEmpty(vc))
        {
            bc = this.Request.Query["c"];
            vc = this.Request.Query["r"];
        }

        this.SiteBasic = (from c in this.Db.SiteBasic select c).ToList()[0];

        this.PdProduct = this.Db.PdProduct.FirstOrDefault(x => x.Batcode == bc && x.Randomcode == vc);
        if (this.PdProduct != null)
        {
            this.ProductClass = this.Db.BaseProductClass.FirstOrDefault(x => x.Id == this.PdProduct.Classid);
            this.Material = this.Db.BaseProductMaterial.FirstOrDefault(x => x.Id == this.PdProduct.Materialid);
            this.Spec = this.Db.BaseSpecifications.FirstOrDefault(x => x.Id == this.PdProduct.Specid);
            this.PdWorkshopTeam = this.Db.PdWorkshopTeam.FirstOrDefault(x => x.Id == this.PdProduct.WorkShift);
            this.PdWorkshop = this.Db.PdWorkshop.FirstOrDefault(x => x.Id == this.PdWorkshopTeam.WorkshopId);
            this.PdStockOut = this.Db.PdStockOut.FirstOrDefault(c => c.Productid == this.PdProduct.Id);
        }
    }
}
@{
    ViewData["Title"] = "服务";
    ViewData["Desc"] = "服务";
    ViewData["Tag"] = 2;
    var siteBasic = _cmsService.GetBasic();
    var mngSetting = _cmsService.GetSetting();
    ViewBag.SiteBasic = siteBasic;
    ViewBag.SiteSetting = mngSetting;
}
<div class="portion query_result">
    @if (Model.PdProduct == null)
    {
        <div class="nodata" style="position:initial;padding-top:100px;padding-bottom:100px;height:initial;">
            <img src="~/Content/images/nodata.png" style="width:40%;" />
            <div class="tip" style="color:gray;padding:10px 0px;">
                暂无产品信息！
            </div>
        </div>
    }
    else
    {
        <div class="title_bar">
            <h1>@Model.SiteBasic.CompName</h1>
        </div>
        <div class="content">
            <div class="row_box">
                <h2>产品名称</h2>
                <p>@Model.ProductClass.Gbname</p>
                <div class="clearfix"></div>
            </div>
            <div class="row_box">
                <h2>牌号</h2>
                <p>@Model.Material.Name</p>
                <div class="clearfix"></div>
            </div>
            <div class="row_box left_box">
                <h2>批号</h2>
                <p>@Model.PdProduct.Batcode</p>
                <div class="clearfix"></div>
            </div>
            <div class="row_box right_box">
                <h2>批号校验码</h2>
                <p>@Model.PdProduct.Randomcode</p>
                <div class="clearfix"></div>
            </div>
            <div class="clearfix"></div>
            <div class="row_box left_box">
                <h2>规格</h2>
                <p>@Model.Spec.Specname</p>
                <div class="clearfix"></div>
            </div>
            <div class="row_box right_box">
                <h2>定尺</h2>
                <p>@Model.PdProduct.Length<text>m</text></p>
                <div class="clearfix"></div>
            </div>
            <div class="clearfix"></div>
            <div class="row_box left_box">
                <h2>捆号</h2>
                <p>@Model.PdProduct.Bundlecode</p>
                <div class="clearfix"></div>
            </div>
            <div class="row_box right_box">
                <h2>支数</h2>
                <p>@Model.PdProduct.Piececount</p>
                <div class="clearfix"></div>
            </div>
            <div class="clearfix"></div>
            <div class="row_box">
                <h2>重量</h2>
                <p>@Model.Spec.Referpieceweight kg</p>
                <div class="clearfix"></div>
            </div>
            <div class="row_box right_box">
                <h2>生产班组</h2>
                <p>@Model.PdWorkshopTeam.TeamName</p>
                <div class="clearfix"></div>
            </div>
            <div class="clearfix"></div>
            <div class="row_box">
                <h2>生产日期</h2>
                <p>@Util.Extensions.GetDateTimeFromUnixTime((long)Model.PdProduct.Createtime).ToString("yyyy年MM月dd日")</p>
                <div class="clearfix"></div>
            </div>
            <div class="row_box">
                <h2>出厂日期</h2>
                @if (Model.PdStockOut != null && Model.PdStockOut.Createtime.HasValue)
                {
                    <p>@(((long)Model.PdStockOut.Createtime.Value).GetDateTimeFromUnixTime().ToString("yyyy年MM月dd日"))</p>
                }
                else
                {
                    <p>&nbsp;&nbsp;&nbsp;&nbsp;年&nbsp;&nbsp;月&nbsp;&nbsp;日</p>
                }
                <div class="clearfix"></div>
            </div>
            <div class="row_box">
                <h2>指定查询官网</h2>
                <p>@mngSetting.Domain_PC</p>
                <div class="clearfix"></div>
            </div>
        </div>
    }
</div>

<div class="portion stamp">
    <div class="title_bar">
        <img src="/Content/images/stamp.png" />
        <h1>打印《产品质量证明书》</h1>
    </div>
    <div class="content">
        <div class="row_box">
            <h2>手机</h2>
            <div class="input_box"><input type="text" id="UserName" name="UserName" maxlength="11" placeholder="请输入手机号码" /></div>
            <input class="send" type="button" name="validcode" id="sendcode" value="发送验证码" />
        </div>
        <div class="row_box">
            <h2>短信验证码</h2>
            <div class="input_box"><input type="text" id="Code" name="Code" maxlength="4" placeholder="请输入验证码" autocomplete="on" /></div>
        </div>
        <span>请通过您的供货商获取电子《产品质量证明书》授权，登录官网下载。</span>
        <input type="hidden" name="SystemMemberType" id="SystemMemberType" value="@Convert.ToInt32(DataLibrary.EnumList.SystemMemberType.Seller)" />
        <div class="determine"><input class="common_button" type="submit" id="btnLogin_ByPhone" value="确定"></div>
    </div>
</div>

@section head
    {
    <link href="/Content/css/service.css" rel="stylesheet" />
    <link type="text/css" href="/Content/js/layui/css/layui.css" rel="stylesheet" />
    <script type="text/javascript" src="/Content/js/layui/layui.js"></script>
    <script type="text/javascript" src="/Content/js/login.js"></script>
}



