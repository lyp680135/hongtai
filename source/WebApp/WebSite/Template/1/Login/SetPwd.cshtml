@page
@inject ICMSService _cmsService
@inject DataLibrary.DataContext Db
@{
    Layout = null;
}
@functions{
    /// <summary>
    /// Gets or sets 页面提示
    /// </summary>
    public string Msg { get; set; }

    [BindProperty]
    public string SetPwd { get; set; }

    [BindProperty]
    public string SetPwd2 { get; set; }

    public void OnGet()
    {
        if (!_cmsService.IuserService.IsAuth || !_cmsService.IuserService.IsManageMember)
        {
            this.Response.Redirect("/Manage/NoPermission");
        }
    }

    public void OnPost()
    {
        if (this.SetPwd.Length < 6)
        {
            this.Msg = "密码长度应不少于6位";
            return;
        }
        else if (this.SetPwd != this.SetPwd2)
        {
            this.Msg = "两次输入的密码不致";
            return;
        }
        else
        {
            var mngAdmin = _cmsService.IuserService.ApplicationUser.Mng_admin;
            mngAdmin.Password = Util.Helpers.Encrypt.Md5By32(this.SetPwd);

            this.Db.MngAdmin.Update(mngAdmin);
            this.Db.SaveChanges();

            this.Msg = "设置成功";
        }
    }
}
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>设置密码</title>
    <link rel="stylesheet" type="text/css" href="/Content/css/base.css">
    <link href="/Content/css/bootstrap.min.css" rel="stylesheet" />
    <script src="/Content/js/jquery.min.js" type="text/javascript"></script>
    <link href="/Content/css/index.css" rel="stylesheet" type="text/css" />
    <link type="text/css" href="/js/layui/css/layui.css" rel="stylesheet" />
    <script type="text/javascript" src="/js/layui/layui.js"></script>
    <script src="/js/login.js"></script>
    <script src="/js/jquery-1.8.2.js"></script>
    <script type="text/javascript">

        $(document).ready(function () {
            var tips = "@Html.Raw(Model.Msg)";
            if (tips == "设置成功") {
                parent.layer.msg(tips, { icon: 1 });
                parent.window.location.href = "/Manage/";
            } else if(tips != "") {
                parent.layer.msg(tips, { icon: 2 });
            }
        });
    </script>
</head>
<body>
    <div class="container_box" style="height:236px;width:300px;margin:0 auto;">
        <form method="post" id="form1">
            <div class="portion stamp">
                <div class="setpwd">
                    <img src="/images/introduce.png" />
                    <h1>设置您的密码 @Model.Msg</h1>
                </div>
                <div class="content">
                    <div class="row_box">
                        <h2>密码</h2>
                        <div class="input_box"><input type="password" placeholder="设置您的密码" id="SetPwd" name="SetPwd" /></div>
                    </div>
                    <div class="row_box">
                        <h2>密码确认</h2>
                        <div class="input_box"><input type="password" id="SetPwd2" name="SetPwd2" placeholder="再输入一遍进行确认" /></div>
                    </div>
                    <span style="text-align:left;">设置密码后，下次可以使用手机号与密码登录</span>
                    <div class="determine"><input class="common_button" type="button" value="确定" id="btn_SetPwd"></div>
                </div>
            </div>
        </form>
    </div>
</body>
</html>
