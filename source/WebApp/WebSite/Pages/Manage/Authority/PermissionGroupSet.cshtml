@page
@model WarrantyManage.Pages.Manage.Authority.PermissionGroupSetModel
@{
    Layout = null;
}

<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=8" />
    <title>角色权限设置</title>
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    @{ await Html.RenderPartialAsync("_ValidationCssPartial");}
    <script src="/js/jquery.treeview.js"></script>
</head>
<body>

    <div class="place">
        <span>位置：</span>
        <ul class="placeul">
            <li>基本设置</li>
            <li>角色与权限设置</li>
            <li>角色管理</li>
            <li>角色权限设置</li>
        </ul>
    </div>
    @if (string.IsNullOrEmpty(Model.Msg))
    {
        <div class="rightinfo">
            <form id="form1" method="post">
                <div style="width:20%;display:inline-block;margin-left:10%;vertical-align:top;" id="tree1">
                    <div class="formtext">
                        <font class="tablelink">@(Model.ModelPermissionGroup != null ? Model.ModelPermissionGroup.GroupName : "")</font> 菜单功能权限
                    </div>
                </div>
                <div style="width:70%;text-align:center;margin-top:35px;">
                    <input type="submit" class="sbbtn" value="保存" />
                </div>
            </form>
        </div>
    }
    <script type="text/javascript">

        function showall(menu_list,parid,parent,chkname)
        {
            for (var menu in menu_list) {

                var chk="";
                if(menu_list[menu].showchk){
                    chk=  "&nbsp;<input data-parpath=\""+ menu_list[menu].parpath+"\" type=\"checkbox\" value=\""+ menu_list[menu].id+"\" name=\""+chkname+"\" "+ (menu_list[menu].chkvalue?"checked=\"checked\"":"")+" />&nbsp;";
                }

                var li = $("<li> <span class="+menu_list[menu].type +"><label>"+chk+ menu_list[menu].name +"</label></span></li>");

                if (menu_list[menu].parid == parid) {
                    if(menu_list[menu].childnum > 0){
                        $(li).append("<ul></ul>").appendTo(parent);
                        showall(menu_list,menu_list[menu].id, $(li).find("ul").eq(0),chkname);
                    }else{
                        $(li).appendTo(parent);
                    }
                }
            }}

        function getParList(menu_list,parid)
        {
            var list = menu_list;
            for (var li in list) {
                if(list[li].id !=parid)
                {
                    delete list[li];
                }
            }
            return list;
        }

        $(document).ready(function () {
            @Html.Raw(Model.Msg)

            var jsonPermission= @Html.Raw(Model.TreeViewData);

            var showlist = $("<ul id=\"browser\" class=\"filetree treeview-famfamfam\"></ul>");

            showall(jsonPermission, 0, showlist,"Permissions");

            $("#tree1").append(showlist);

            $("#browser").treeview();

            $("input[type=checkbox]").change(function(){

                var myparent=$(this).parent().parent();
                selectedParId($(this));
                if($(myparent).attr("class").indexOf("folder")> -1)
                {
                    $(myparent).parent().find("input").prop("checked",$(this).prop("checked"));
                }
            });
        });

        function selectedParId(obj)
        {
            var name= $(obj).attr("name"); var parpath= $(obj).data("parpath"); var flag= $(obj).prop("checked");
            var pph= parpath.split(',');

            $("input[name="+name+"]").each(function(){
                if(flag)
                {
                    for(var i=0;i<pph.length;i++)
                    {
                        if(pph[i] != "" && $(this).val() == pph[i] )
                        {
                            $(this).prop("checked",true);
                        }
                    }

                }
            });
        }
    </script>

</body>
</html>