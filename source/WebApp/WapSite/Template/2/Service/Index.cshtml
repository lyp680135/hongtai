@page
@inject ICMSService _cmsService
@{
    ViewData["Tag"] = 2;
    ViewData["Title"] = "服务";
    ViewData["Desc"] = "服务";
    var siteBasic = _cmsService.GetBasic();
    var mngSetting = _cmsService.GetSetting();
    ViewBag.SiteBasic = siteBasic;
    ViewBag.SiteSetting = mngSetting;
}


@section head
    {
    <link href="/Content/css/service.css" rel="stylesheet" />
    <script src="/Content/js/layui/layui.js" type="text/javascript"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/getscript?v=2.0&ak=507E36FA8f5d0bf5b491248d86d04bf7"></script>
    <style type="text/css">
        .layui-layer-content {
            color:#fff;
        }
    </style>
}
<div class="banner_share">
    <img src="/Content/images/service_center.jpg" />
</div>

<div class="search_box padding_box">
    <div class="title_box">
        <h1>产品质量证明书/</h1>
        <small>INSPECTION CERTIFICATE</small>
        <div class="clearfix"></div>
    </div>
    <span>闽源钢铁《产品质量证明书》网上查询</span>

    <div class="content">
        <form id="form1" method="post" onsubmit="return submitSearch()">
            <div class="row_box">
                <h2>产品批号</h2>
                <div class="input_box"><input type="text" name="batcode" id="batcode" placeholder="请输入产品批号" /></div>
            </div>
            <div class="row_box">
                <h2>校验码</h2>
                <div class="input_box"><input type="text" name="validcode" id="validcode" placeholder="请输入批号校验码" maxlength="3" /></div>
            </div>
            <input class="common_button" type="submit" value="查询" />
        </form>
    </div>
</div>
<div class="contact padding_box">
    <div class="title_box">
        <h1>联系我们/</h1>
        <small>CONTACT US</small>
        <div class="clearfix"></div>
    </div>

    @{
        var Phone = _cmsService.IcontentColumnDataService.GetContentColumnDataList("联系闽源", 1, 5);
        if (Phone != null)
        {
            foreach (var P in Phone)
            {
                <div class="contact_row">
                    <img src="/Content/images/contact1.png" />
                    <p>电 话:@Html.Raw(P["Phone"])</p>
                    <div class="clearfix"></div>
                </div>
                <div class="contact_row">
                    <img src="/Content/images/contact3.png" />
                    <p>传 真:@Html.Raw(P["ZipCode"])</p>
                    <div class="clearfix"></div>
                </div>
                <div class="contact_row">
                    <img src="/Content/images/contact2.png" />
                    <p>邮 编:@Html.Raw(P["Fax"])</p>
                    <div class="clearfix"></div>
                </div>
                <div class="contact_row">
                    <img src="/Content/images/contact6.png" />
                    <p>邮 箱:@Html.Raw(P["Email"])</p>
                    <div class="clearfix"></div>
                </div>
                <div class="contact_row">
                    <img src="/Content/images/contact5.png" />
                    <p>网 址:@Html.Raw(P["Url"])</p>
                    <div class="clearfix"></div>
                </div>
                <div class="contact_row">
                    <img src="/Content/images/contact4.png" />
                    <p>地 址:@Html.Raw(P["Address"])</p>
                    <div class="clearfix"></div>
                </div>
                <div class="map_box">
                    <div style="width:98%;height:210px;border:#ccc solid 1px;margin:0 1%;margin-top:8px;" id="dituContent"></div>
                    <p id="ComAddress">@Html.Raw(P["Address"])</p>
                </div>
            }
        }
    }
</div>
<script type="text/javascript">
    var ComAddress = $("#ComAddress").html();
    //创建和初始化地图函数：
    function initMap() {
        //var icon = new BMap.Icon("http://map.baidu.com/image/us_mk_icon.png", new BMap.Size(100, 100));
        createMap();//创建地图
        setMapEvent();//设置地图事件
        //addMapControl();//向地图添加控件
    }

    //创建地图函数：
    function createMap() {
        var map = new BMap.Map("dituContent");//在百度地图容器中创建一个地图
        var localSearch = new BMap.LocalSearch(map);
        localSearch.enableAutoViewport();
        localSearch.setSearchCompleteCallback(function (searchResult) {
            var new_point = new BMap.Point(@siteBasic.MapLocation);
            var marker = new BMap.Marker(new_point);  // 创建标注
            map.addOverlay(marker);              // 将标注添加到地图中
           // marker.addEventListener("click", function () {
           //     this.openInfoWindow(infoWindow);
            //});
            map.centerAndZoom(new_point, 17);
        });
        localSearch.search(ComAddress);
        window.map = map;//将map变量存储在全局
    }

    //地图事件设置函数：
    function setMapEvent() {
        map.enableDragging();//启用地图拖拽事件，默认启用(可不写)
        map.enableScrollWheelZoom();//启用地图滚轮放大缩小
        map.enableDoubleClickZoom();//启用鼠标双击放大，默认启用(可不写)
        map.enableKeyboard();//启用键盘上下左右键移动地图
    }
            initMap();//创建和初始化地图
</script>
<script type="text/javascript">

    layui.use('layer', function () {
        var $ = layui.jquery, layer = layui.layer;
    });
    function submitSearch() {
        if (!$("#batcode").val()) {
            $("#batcode").focus();
            layer.msg('请输入产品批号！');
            return false;
        }
        if (!$("#validcode").val()) {
            $("#validcode").focus();
            layer.msg('请输入批号校验码！');
            return false;
        }
        var url = '/Service/SearchProduct';
        var layerload= layer.load(1);
        $.ajax({
            type: "POST",
            url: url,
            data: $("#form1").serialize(),
            success: function (re) {
                if (re == "success") {
                    window.location.href = "/Service/Detail?batcode=" + $("#batcode").val() + "&validcode=" + $("#validcode").val();
                } else {
                    layer.msg(re);
                }
                layer.close(layerload);
            }, error: function (XMLHttpRequest, textStatus, errorThrown) {
                layer.close(layerload);
                layer.msg('操作失败，出现服务器错误！');
            }
        });
        return false;
    }
</script>